{% load static %}
{% load compress %}
<!DOCTYPE html>
<html>
  <head>
      

      {% compress css %}
          <link href="{% static 'admin/css/custom.scss' %}" rel="stylesheet" type="text/x-scss">
      {% endcompress %}
      <script type="text/javascript">
          function preventBack() {
              window.history.forward(); 
          }
            
          setTimeout("preventBack()", 0);
            
          window.onunload = function () { null };
      </script>
      <title>Nova</title>
      <link rel="icon" type="image/x-icon" href="{% static 'admin/img/favicon.ico' %}">
  </head>
  <body style="background-color:#ffffff;">
    {% include 'nova_core/base_navbar.html' %}

    <div class="row mx-2 justify-content-between align-items-end">
      <div class="col-4">
        <h3 class="display-3 mt-3 mx-4 my-1"> </h3>
      </div>

      <div class="col-4">
        <h2 class="display-3 mt-3 mx-4 my-1" style="color: rgb(150, 0, 0);">{{ session_desc }}</h2>
      </div>
    </div>

    <div class="row mx-2 justify-content-between text-center">
      <div class="col">
        <h3 class="display-3 mt-3 mx-4 my-1">CASE System</h3>
      </div>
    </div>

    <div class="row mx-2"> 
      <div class="col d-flex justify-content-center">
        <div class="card m-3 shadow-lg" style="width: 18rem; ">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">My Cases</h5>
            {% if my_cases.count > 0 %}<span class="badge rounded-pill bg-primary">{{ my_cases.count }} Case{{my_cases.count|pluralize}} Assigned To Me</span>{% else %}<span class="badge rounded-pill bg-success">All Tasks Completed</span>{% endif %}
            <p class="card-text">A list of cases currently assigned to me.</p>
            <a href="{% url 'my_cases' %}" class="mt-auto btn btn-outline-primary">Go to My Cases</a>
          </div>
        </div>
        <div class="card m-3 shadow-lg" style="width: 18rem; ">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">Create Cases</h5>
            <p class="card-text">Create new cases from overdue scripts</p>
            <a href="{% url 'case_system_create' %}" class="mt-auto btn btn-outline-primary">Run CASE</a>
          </div>
        </div>
      </div>
      
      
      <div class="table-responsive-xl m-5">
        <table class="table table-sm table-bordered table-hover">
            <tr class="text-center">
              <th>Case ID</th>
              <th>Examiner Creditor</th>
              <th>Examiner Name</th>
              <th>Case Date</th>
              <th>Script Count</th>
              <th>Case Owner</th>
              <th>Case Assignment Date</th>
              <th colspan="2">Assignment</th>
            </tr>
            {% for case in all_cases %}
                    <tr class="text-center">
                      <td><a href=''><button class="btn btn-outline-primary" style="width:120px">{{ case.id }}</button></a></td> 
                      <td>{{ case.enpe_sid.per_sid.exm_creditor_no }}</td>
                      <td>{{ case.enpe_sid.per_sid.exm_title }} {{ case.enpe_sid.per_sid.exm_forename }} {{ case.enpe_sid.per_sid.surname }}</td>
                      <td>{{ case.task_creation_date }}</td>
                      <td>{{ case.case_apportioned_scripts.count }}</td>
                      <td>{{ case.task_assigned_to }}</td>
                      <td>{{ case.task_assigned_date }}</td>
                      <td><form method="POST" action="{% url 'self-assign-case' case_id=case.id  %}" class="text-center">
                          <input name="page_location" id="page_location" value="cleric_list" type="hidden" class="form-control">
                          {% if request.user.username == y.task_assigned_to.username %}
                            <button disabled type="submit" class="btn btn-outline-secondary" style="width:120px">Assign to Me</button>
                          {% else %}
                            <button type="submit" class="btn btn-outline-primary" style="width:120px">Assign to Me</button>
                          {% endif %}
                      </form></td>
                      <td><form method="POST" action="{% url 'assign-case-user' case_id=case.id  user_id=request.user.id %}" class="text-center">
                        <input name="page_location" id="page_location" value="cleric_list" type="hidden" class="form-control">
                        <button type="submit" class="btn btn-outline-warning" style="width:120px">Assign To</button>
                    </form></td>
                    </tr>
            {% endfor %}
        </table>
      </div>
    
    </div>
  </body>
</html>




