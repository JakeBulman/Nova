{% extends 'nova_core/base.html' %}

{% block content %}

<h1 class="display-5 text-center mb-5">EAR - Panels</h1>


    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
        <li class="page-item">
            {% if ep.has_previous %}
            <a class="page-link" href="?page={{ep.previous_page_number}}&search_query={{sq}}" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
            </a>
            {% else %}
            <a class="page-link disabled" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
            </a>
            {% endif %}
        </li>

        <li class="page-item">
            {% if ep.number == 1 %}
            <a class="page-link disabled"aria-label="First">
            <span aria-hidden="true">First</span>
            </a>
            {% else %}
            <a class="page-link" href="?page=1&search_query={{sq}}" aria-label="First">
                <span aria-hidden="true">First</span>
            </a>
            {% endif %}
        </li>

        <li class="page-item"><a class="page-link active"style="width: 45px; text-align:center">{{ep.number}}</a></li>

        <li class="page-item">
            {% if ep.number == ep.paginator.num_pages %}
            <a class="page-link disabled"aria-label="Last">
            <span aria-hidden="true">Last ({{ep.paginator.num_pages}})</span>
            </a>
            {% else %}
            <a class="page-link" href="?page={{ep.paginator.num_pages}}&search_query={{sq}}" aria-label="Previous">
                <span aria-hidden="true">Last ({{ep.paginator.num_pages}})</span>
            </a>
            {% endif %}
        </li>

        <li class="page-item">
            {%if ep.has_next %}
            <a class="page-link" href="?page={{ep.next_page_number}}&search_query={{sq}}" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
            </a>
            {% else %}
            <a class="page-link disabled" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
            </a>
            {% endif %}
        </li>
        </ul>
    </nav>

    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-auto">
                <form class="text-center" style="width:500px" method="GET" action='/enquiries/panel_list'>
                    <div>
                    <input name="search_query" id="search_query" type="text" class="form-control mb-1" placeholder="Syllabus/Component" value={{sq}}>
                    </div>
                    <button type="submit" class="btn btn-outline-primary text-center" style="width:200px">Search</button>
                </form>
            </div>
        </div>
    </div>

    <div class="table-responsive-xl m-5">
        <table class="table table-sm table-bordered table-hover align-middle text-center">
            <tr class="text-center">
                <th>Syll/Comp</th>
                <th>Panel Name</th>
                <th>Original Panel Size</th>
                <th>EAR Panel Size</th>
                <th>Apportionment Type</th>
                <th>Panel Notes</th>
                <th>Update Notes</th>
            </tr>
            {% for pan in ep %}
                <tr>
                    <td>{{ pan.ass_code }}/{{ pan.com_id }}</td>
                    <td>{{ pan.panel_name }}</td>
                    <td>{{ pan.panel_size }}</td>
                    <td>{{ pan.exm_count }}</td>
                    <td>{% if pan.manual_apportionment %}
                        <form method="POST" action="{% url 'panel_set_manual' %}">
                            <input name="panel_id" id="panel_id" value={{pan.id}} type="hidden" class="form-control">
                            <button type="submit" title="Pause Enquiry" class="btn btn-outline-danger my-2" style="width: 200px;">Manual Apportion</button>
                        </form>
                        
                        {% else %}
                        <form method="POST" action="{% url 'panel_set_manual' %}">
                            <input name="panel_id" id="panel_id" value={{pan.id}} type="hidden" class="form-control">
                            <button type="submit" title="Pause Enquiry" class="btn btn-outline-success my-2" style="width: 200px;">Auto Apportion</button>
                        </form>
                        {% endif %}</td>
                    <td>{{ pan.panel_notes }}</td>
                    <td>    
                        <div class="text-center">
                            <button type="submit" title="Edit" class="btn btn-outline-primary text-center" style="width:200px"
                            data-bs-toggle="modal" data-bs-target="#exampleModal{{pan.id}}">Update Notes</button>
                        </div>
                        <div class="modal fade" id="exampleModal{{pan.id}}" tabindex="-1" data-bs-backdrop="static" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                              <div class="modal-content">
                                <div class="modal-header">
                                  <h5 class="modal-title" id="exampleModalLabel">Update Panel Note - {{pan.id}}</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                  <form method="POST" action="{% url 'panel_update_note' %}">
                                    <input name="panel_id" id="panel_id" value={{pan.id}} type="hidden" class="form-control">
                                    <div class="mb-3">
                                      <div>Old Note:</div>
                                      <div>{{pan.panel_notes}}</div>
                                      <label for="panel_notes" class="col-form-label">New Note:</label>
                                      <textarea class="form-control" id="panel_notes" name="panel_notes"></textarea>
                                    </div>
                                    <button type="submit" title="Pass" class="btn btn-outline-primary" style="width:150px" data-bs-dismiss="modal">Continue</button>
                                  </form>
                                </div>
                              </div>
                            </div>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>


{% endblock %}
