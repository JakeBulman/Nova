{% extends 'base.html' %}

{% block content %}

<style type="text/css">
    .container-fluid.custom-container {
      padding: 0 50px;
    }
</style>

<h1 class="display-5 text-center mb-5">EAR Task - Previous Examiner Check</h1>

<div class="custom-container container-fluid">
    <div class="row text-center">
        <a class="btn btn-secondary btn-lg my-2" href='/enquiries/task_manager/my_tasks'>Back to My Tasks</a>
    </div>
    <div class="row text-center my-3">
        <h5>Task Summary</h5>
        <table class="table table-sm table-bordered table-hover text-center">
            <tr class="text-center">
                <th>Task ID</th>
                <td>{{ task.id }}</td>
                <th>Centre Number</th>
                <td>{{ task.ec_sid.erp_sid.eps_centre_id }}</td>
            </tr>
            <tr class="text-center">
                <th>Enquiry ID</th>
                <td><a href='/enquiries/enquiries_detail/{{ task.enquiry_id.enquiry_id }}'>{{ task.enquiry_id.enquiry_id }}</a></td>
                <th>Candidate Number</th>
                <td>{{ task.ec_sid.erp_sid.eps_cand_id }}</td>
            </tr>
            <tr class="text-center">
                <th>Script ID</th>
                <td>{{ task.ec_sid.ec_sid }}</td>
                <th>Syllabus</th>
                <td>{{ task.ec_sid.eps_ass_code }}</td>
            </tr>
            <tr class="text-center">
                <th>Batch ID</th>
                <td>{% for bat in task.ec_sid.script_id.all %}{{ bat.eb_sid.eb_sid }}{% endfor %}</td>
                <th>Component</th>
                <td>{{ task.ec_sid.eps_com_id }}</td>
            </tr>
            <tr class="text-center">
                <th>Original Examiner</th>
                <td>{% for exm in task.ec_sid.script_pexmch.all %}{{ exm.exm_position }}{% endfor %}</td>
                <th>Review Reason</th>
                <td>{% for exm in task.ec_sid.script_pexmch.all %}{{ exm.kbr_reason }}{% endfor %}</td>
            </tr>
        </table>
        <h5>Task Instruction</h5>
        <div>Please check RM and indicate which examiners have seen this script previously.</div>
    </div>

    <div class="row text-center">
        <div class="col-6 align-self-center">
            <h5>Available Examiner List</h5>
            <table class="table table-sm table-bordered table-hover">
                <tr class="text-center">
                    <th>Creditor Number</th>
                    <th>Examiner Name</th>
                    <th>Examiner Email</th>
                    <th>Examiner Position</th>

                </tr>
                {% for exm in ep %}
                    
                    <tr>
                        <td class="text-center"><a class="btn btn-outline-primary" style="width:100px" href='/enquiries/examiner_detail/{{ exm.per_sid }}'>{{ exm.exm_creditor_no }}</a></td>
                        <td>{{ exm.exm_title }} {{ exm.exm_initials }} ({{ exm.exm_forename }}) {{ exm.exm_surname }}</td>
                        {% if exm.exm_email_manual.all.count > 0 %}
                            <td>{% for emails in exm.exm_email_manual.all %}{{ emails.examiner_email_manual|upper }}{% endfor %}</td>
                        {% else %}
                            <td>{{ exm.exm_email }}</td>
                        {% endif %}

                        {% for exm2 in exm.creditors.all %}
                        {% for exm3 in exm2.exm_per_details.all %}
                        {% if exm3.ass_code == task.ec_sid.eps_ass_code and exm3.com_id == task.ec_sid.eps_com_id %}
                        
                        <td>
                            <table class="table table-sm text-center">

                                    <tr>
                                        <td>{{ exm3.exm_examiner_no }}</td>
                                    </tr>

                            </table>
                        </td>

                        {% endif %}
                        {% endfor %}
                        {% endfor %}

                {% endfor %}
            </table>

        </div>
        <div class="col-6">
            <h5>Examiner Form</h5>
            <form method="POST" action="{% url 'pexmch-complete' %}" class="text-center">
                <input name="script_id" id="script_id" value={{task.ec_sid.ec_sid}} type="hidden" class="form-control">
                <input name="task_id" id="task_id" value={{task.id}} type="hidden" class="form-control">
                <input name="enquiry_id" id="enquiry_id" value={{task.enquiry_id.enquiry_id}} type="hidden" class="form-control">
                <label class="form-label">Please fill in as many examiners as required, including the original examiner if this is still valid.</label>
                <label class="form-label fw-bold mb-3">The input should be a position code, such as "01.01".</label>

                <div class="row">
                    <div class="col">
                        <label class="d-flex justify-content-end align-items-end pe-3">Examiner 1</label>
                    </div>
                    <div class="col">
                        <input name="exm_1" id="exm_1" type="text" class="form-control text-center w-25" required> 
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label class="d-flex justify-content-end align-items-end pe-3">Examiner 2</label>
                    </div>
                    <div class="col">
                        <input name="exm_2" id="exm_2" type="text" class="form-control text-center w-25" > 
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label class="d-flex justify-content-end align-items-end pe-3">Examiner 3</label>
                    </div>
                    <div class="col">
                        <input name="exm_3" id="exm_3" type="text" class="form-control text-center w-25" > 
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label class="d-flex justify-content-end align-items-end pe-3">Examiner 4</label>
                    </div>
                    <div class="col">
                        <input name="exm_4" id="exm_4" type="text" class="form-control text-center w-25" > 
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label class="d-flex justify-content-end align-items-end pe-3">Examiner 5</label>
                    </div>
                    <div class="col">
                        <input name="exm_5" id="exm_5" type="text" class="form-control text-center w-25" > 
                    </div>
                </div>
                <button type="submit" class="btn btn-success btn-lg my-4" style="width:300px">Confirm Examiners</button>
            </form>
        </div>
    </div>  

</div>



{% endblock %}