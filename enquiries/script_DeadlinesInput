import sys
import os
import django
import datetime

if os.getenv('DJANGO_DEVELOPMENT') == 'true':
    print('DEV')
    path = os.path.join('C:\\Users\\bulmaj\\OneDrive - Cambridge\\Desktop\\Dev\\Nova')
    sys.path.append(path)
    os.environ['DJANGO_SETTINGS_MODULE'] = 'redepplan.settings_dev'
elif os.getenv('DJANGO_PRODUCTION') == 'true':
    print('PROD')
    path = os.path.join('C:\\Dev\\Nova')
    sys.path.append(path)
    os.environ['DJANGO_SETTINGS_MODULE'] = 'redepplan.settings_prod'
else:
    print('UAT')
    sys.path.append('C:/Dev/redepplan')
    os.environ['DJANGO_SETTINGS_MODULE'] = 'redepplan.settings'

django.setup()

from enquiries.models import CentreEnquiryRequests, EnquiryDeadline, EnquiryRequestParts

def run_algo():
    EnquiryDeadline.objects.all().delete()
    for enquiry in CentreEnquiryRequests.objects.all():
        erp_service = EnquiryRequestParts.objects.filter(cer_sid = enquiry.enquiry_id).first().service_code
        if 'P' in erp_service:
            deadline = enquiry.eps_creation_date + datetime.timedelta(days=18)
            print('P')
        else:
            deadline = enquiry.eps_creation_date + datetime.timedelta(days=30)
            print('Not P')
        EnquiryDeadline.objects.create(
            enquiry_id = enquiry,
            enquiry_deadline = deadline,
            original_enquiry_deadline = deadline
        )




run_algo()